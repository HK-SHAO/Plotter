<!doctype html>
<html>

<head>
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"
        name="viewport">
    <title>绘图计算器（开发中v1.84）</title>
    <style type="text/css">
        ::-webkit-scrollbar {
            display: none;
        }

        #father #gc {
            border: solid;
            position: absolute;
            z-index: 2;
        }

        #father #gc2 {
            border: solid;
            position: absolute;
            z-index: 1;
        }

        button {
            height: 1.5em;
            width: 2em;
            padding: 0;
            margin: 0;
            font-family: Consolas;
            font-size: 24px;
            margin-left: -6px;
            margin-top: -1px;
        }

        @media(min-width:900px) {


            #father {
                position: fixed;
                top: 50%;
                transform: translateY(-50%)
            }

            #ed {
                font-size: 24px;
                font-weight: bold;
                width: 80%;
                resize: vertical;
                font-family: 'Times New Roman', Times, serif;
            }

            #ed2 {
                font-size: 20px;
                font-weight: bold;
                width: 80%;
                resize: vertical;
            }

            .container {
                display: flex;
            }

            .right {
                width: 32%;
                margin-left: 20px;
            }

            .out {
                flex: 1;
                width: 18%;
            }
        }

        @media(max-width:900px) {


            #ed {
                font-size: 24px;
                font-weight: bold;
                width: 95%;
                resize: vertical;
                font-family: 'Times New Roman', Times, serif;
            }

            #ed2 {
                font-size: 20px;
                font-weight: bold;
                width: 95%;
                resize: vertical;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="left" id="lft">
            <div id="father">
                <canvas id="gc" onmouseout="reCanvas2()"></canvas>
                <canvas id="gc2"></canvas>
            </div>
        </div>
        <div class="right">
            <div style="width: 100%;">
                <details open>
                    <summary style="font-size:24px;font-weight:bold;margin-top: 20px;">脚本</summary>
                    <br>
                    <textarea id="ed2" oninput="inChange2()">
fps /*帧率*/= 60;
color /*颜色*/= ["blue"];
p_b /*点精度*/= 200;
ps /*点大小*/= 0.2;
p_n /*线精度*/= 1;
ls /*线粗细*/= 1;
def /*定义*/= {love: 520, you: 1314/520};</textarea>
                </details>
                <details open>
                    <summary style="font-size:24px;font-weight:bold;">表达式</summary>
                    <br>
                    <textarea id="ed" oninput="inChange()">
sin(10x+time/100)/10</textarea>
                </details>
                <details style="word-wrap:break-word" open>
                    <summary style="font-size:20px;font-weight:bold;">键盘</summary>
                    <br>
                    <button onclick="insertText('0')">0</button>
                    <button onclick="insertText('1')">1</button>
                    <button onclick="insertText('2')">2</button>
                    <button onclick="insertText('3')">3</button>
                    <button onclick="insertText('4')">4</button>
                    <button onclick="insertText('5')">5</button>
                    <button onclick="insertText('6')">6</button>
                    <button onclick="insertText('7')">7</button>
                    <button onclick="insertText('8')">8</button>
                    <button onclick="insertText('9')">9</button>
                    <br>
                    <button onclick="insertText('+')">+</button>
                    <button onclick="insertText('-')">-</button>
                    <button onclick="insertText('*')">×</button>
                    <button onclick="insertText('/')">÷</button>
                    <button onclick="insertText('^')">^</button>
                    <button onclick="insertText('sqrt(')">√</button>
                    <button onclick="insertText('\'')">'</button>
                    <button onclick="insertText('(')">(</button>
                    <button onclick="insertText(',')">,</button>
                    <button onclick="insertText(')')">)</button>
                    <br>
                    <button onclick="insertText('.')">.</button>
                    <button onclick="insertText('&')">&</button>
                    <button onclick="insertText('|')">|</button>
                    <button onclick="insertText('~')">~</button>
                    <button onclick="insertText('<')">&lt;</button>
                    <button onclick="insertText('==')">≡</button>
                    <button onclick="insertText('>')">&gt;</button>
                    <button onclick="insertText('[')">[</button>
                    <button onclick="insertText(':')">:</button>
                    <button onclick="insertText(']')">]</button>
                    <br>
                    <button onclick="insertText('!')">!</button>
                    <button onclick="insertText('Infinity')">∞</button>
                    <button onclick="insertText(' mod ')">%</button>
                    <button onclick="insertText('!=')">≠</button>
                    <button onclick="insertText('<=')">≤</button>
                    <button onclick="insertText('=')">=</button>
                    <button onclick="insertText('>=')">≥</button>
                    <button onclick="insertText('{')">{</button>
                    <button onclick="insertText(';')">;</button>
                    <button onclick="insertText('}')">}</button>
                    <br>
                    <button onclick="insertText('e')">e</button>
                    <button onclick="insertText('π')">π</button>
                    <button onclick="insertText('τ')">τ</button>
                    <button onclick="insertText('φ')">φ</button>
                    <button onclick="insertText('Σ(')">Σ</button>
                    <button onclick="insertText('Π(')">Π</button>
                    <button onclick="insertText('Γ(')">Γ</button>
                    <button onclick="insertText('<<')">←</button>
                    <button onclick="insertText('^|')">bx</button>
                    <button onclick="insertText('>>')">→</button>
                    <br>
                    <button onclick="insertText('ρ')">ρ</button>
                    <button onclick="insertText('θ')">θ</button>
                    <button onclick="insertText('i')">i</button>
                    <button onclick="insertText('k')">k</button>
                    <button onclick="insertText('x')">x</button>
                    <button onclick="insertText('y')">y</button>
                    <button onclick="insertText(' and ')">ad</button>
                    <button onclick="insertText(' or ')">or</button>
                    <button onclick="insertText('not ')">nt</button>
                    <button onclick="insertText(' xor ')">xr</button>
                </details>
                <img id="img" style="max-width: 100%;height: auto;margin-top: 10px;margin-bottom: 10px" />
            </div>
            <h3 id="fpsm" style="position:fixed; bottom:0px; right:20px"></h3>
            <details style="word-wrap:break-word">
                <summary style="font-size:20px;font-weight:bold;">高级</summary>
                <br>
                <a style="font-size:16px;font-weight:bold;">音频&nbsp;&nbsp;</a>
                <button onclick="audiocontrol(this)" style="width: auto;font-size:20px">play</button>
                使用 Play(音调,响度,波形) PlayS(音调,响度,波形,time,x)
                <br><br>
            </details>
            <details style="word-wrap:break-word">
                <summary style="font-size:20px;font-weight:bold;">简要说明</summary>
                <p>本程序正在开发中，目前还处于极度不完善状态，可能会有很多bug。开发者：烧风
                    <br>支持的算符，请参考：https://mathjs.org/docs/expressions/syntax.html
                    <br>支持的常量，请参考：https://mathjs.org/docs/reference/constants.html
                    <br>支持的函数，请参考：https://mathjs.org/docs/reference/functions.html
                    <br>图像的绘制范围固定在区间[-1,1]中，可通过函数的平移和缩放得到你想要的效果
                    <br>表达式计算得到数字、布尔值、复数、矩阵都可以绘制图像
                    <br>在脚本里可以写javascript脚本，修改color数组可以修改绘制的色彩
                    <br>回车换行输入可绘制多个图像，使用 help() 获取参考，例如 help(pi) help(erf)
                    <br>
                    <br> ● 支持绘制多种函数曲线，例如 sin(x) x^x e^x Γ(10x)/10 x%0.5
                    <br> ★ 特点：多种函数绘图，例如 isPrime(x) x=sin(pi*y) ρ=cos(2θ) θ=ρ^ρ
                    <br> ● 支持分段函数，使用三元运算符 x&lt;0?x:x^2-x 或者 min() max() 等
                    <br> ● 支持参数方程（参数k从0到1），例如 k+k*i [k,k^2]/2-0.25 ρθ(k,k) xy(k,k)
                    <br> ● 支持输入不等式绘制平面区域（支持与或运算），例如 sin(x)&lt;y and y&lt;-0.2
                    <br> ● 支持极坐标绘制曲线或者平面区域（使用ρ和θ），例如 ρ&lt;0.5 ρ&lt;θ ρ-0.1
                    <br> ● 可以自定义变量和函数，例如 [n=2,f(x,y)=x^y,f(x,n)][3] 多行输入请看下面的实例
                    <br> ● 支持累乘和累加，例如 Π('n',1:6) Σ('n',1:100) Σ('(n+1)/2',[1,3,5,7,9])
                    <br> ● 使用 time 返回当前时间戳，一般的使用方法是 sin(time/1000)
                    <br> ● 使用 frame 返回帧数。使用 mp 返回当前光标的位置，例如 (x-mp[1])^2+mp[2]
                    <br> ● 使用1×N矩阵绘制柱状图（N=1或N>3），例如 [-0.1,0.4,-0.2,0.4,0.6,0.7]
                    <br> ● 使用1×3矩阵进行着色（建议将点大小改为1），例如 [x,y^2,x*y]
                    <br> ● 使用X×Y矩阵绘制灰度图，例如 [0.1,0.2;0.3,0.4] identity(4) zeros(2,2)
                    <br> ● 使用X×Y×3矩阵绘制RGB图，例如 [[1,0,0];[0,1,0];[0,0,1]] zeros(2,2,3)
                    <br> ★ 绘制分形 Logistic(4x,0.1,100) Mandelbrot(2x,2y,100) Julia(2x,2y,mp[1],mp[2],6)
                </p>
            </details>
            <details style="word-wrap:break-word">
                <summary style="font-size:20px;font-weight:bold">一些实例</summary>
                <code style="font-family: Consolas;font-size: 16px">
                    <h4>波形可视化</h4>
                    >f=800sin(frame/100)
                    <br>>v=0.2
                    <br>>m=0
                    <br>Play(f,v,m)
                    <br>PlayS(f,v,m,time,x)
                    <h4>连线</h4>
                    >a=[-0.5,0.5]
                    <br>>b=mp
                    <br>>c=[0.3,0.2]
                    <br>Line(k,a,b)
                    <br>Line(k,b,c)
                    <br>Line(k,c,a)
                    <h4>二阶贝塞尔曲线</h4>
                    >p0=[-0.5,0.5]
                    <br>>p1=[0.5,0.5]
                    <br>>p2=mp
                    <br>(1-k)^2*p0+2k*(1-k)*p1+k^2*p2
                    <h4>Logistic映射（有多种实现方式）</h4>
                    2x*y*(1-y)+0.1
                    <br>Logistic(4x,0.1,100) 这个式子计算更快，等价于下面的式子
                    <br>[μ=4x,a=0.1,f(a)=μ*a*(1-a),g(n)=n==1?f(a):f(g(n-1)),g(100)][5]
                    <br>你还可以写成多行：（在行头使用>表示这一行只计算而不绘图）
                    <br>a=mp[2]
                    <br>f(a)=5x*a*(1-a)
                    <br>g(n)=n&lt;=1?f(a):f(g(n-1))
                    <br>g(10mp[1])
                    <h4>分叉图</h4>
                    p_n /*线精度*/= 400;
                    <br>ls /*线粗细*/= 0.2;
                    <br>
                    <br>sin((x-1.7)*(y+0.4))+0.4
                    <br>erf((x-2)*(y+0.5)*(1-y))+0.3
                    <br>这是“隐式”迭代，其中的y是绘图过程中上一个点对应的y值。
                    <h4>朱利亚集、曼德勃罗集（点大小改为1，增加点精度，显示效果更好）</h4>
                    Mandelbrot(2x,2y,100) Julia(2x,2y,mp[1],mp[2],6)
                    <br>彩色渲染：MandelbrotC(2x,2y,100) JuliaC(2x,2y,mp[1],mp[2],6)
                    <h4>谢尔宾斯基三角形</h4>
                    p_n /*线精度*/= 100;
                    <br>ls /*线粗细*/= 0.3;
                    <br>[k,(floor(66000k)&(floor(66000k) >> 8))/290]
                    <br>或者 (floor(66000x)&(floor(66000x) >> 8))/290
                    <h4>累乘求π（tip：在行头使用>，只计算而不绘图，提升效率）</h4>
                    >2*Π('n%2==0?n/(n+1):(n+1)/n',1:10000)
                    <h4>时钟（北京时间）</h4>
                    fps /*帧率*/= 60;
                    <br>color /*颜色*/= ["black","blue","black", "green","red"];
                    <br>p_b /*点精度*/= 200;
                    <br>ps /*点大小*/= 0.5;
                    <br>p_n /*线精度*/= 0.1;
                    <br>ls /*线粗细*/= 2;
                    <br>def /*定义*/= {love: 520, you: 1314/520};
                    <br>
                    <br>ρ=0.8
                    <br>[0.8sin(2pi*time/1e3+0.1k),0.8cos(2pi*time/1e3+0.1k)]
                    <br>[0.7sin(2pi*time/6e4)*k,0.7cos(2pi*time/6e4)*k]
                    <br>[0.5sin(2pi*time/36e5)*k,0.5cos(2pi*time/36e5)*k]
                    <br>[0.4sin(2pi*(time+288e5)/432e5)*k,0.4cos(2pi*(time+288e5)/432e5)*k]
                    <h4>螺旋线</h4>
                    ρθ(2k,20*sin(time/1000)k)/4
                    <br>θ=frame*ρ
                    <h4>选色器</h4>
                    p_b /*点精度*/= 50;
                    <br>ps /*点大小*/= 2;
                    <br>
                    <br>(x>0 and y>0)?[x,y,0]:[0,0,0]
                    <br>(x&lt;0 and y&lt;0)?[mp[1],mp[2],0]:[NaN,0,0]
                    <br>
                    <h4>光环</h4>
                    [(sin(frame*ρ)+1)/2,0,0]
                    <h4>复数幂递归（相当于 i^i^i^i^i^...）</h4>
                    p_n /*线精度*/= 0.3;
                    <br>
                    <br>>f(z,n)=n&lt;1?z:z^f(z,n-1)
                    <br>>c=complex(mp[1],mp[2])
                    <br>f(c,300k)
                    <h4>万花筒</h4>
                    fps/*帧率*/=60;
                    <br>color/*颜色*/=["blue"];
                    <br>p_b/*点精度*/=100;
                    <br>ps/*点大小*/=1;
                    <br>p_n/*线精度*/=1;
                    <br>ls/*线粗细*/=1;
                    <br>def/*定义*/={love: 520, you: 1314/520,Q};
                    <br>function Q(x, y, t) {
                    <br>let uv = [x, y];
                    <br>let rot = [Math.sin(t / 100), Math.cos(t / 100)];
                    <br>let l = 0;
                    <br>for (let i = 0; i &lt; 2000; i++) {
                    <br>uv = [1.1*(uv[0]*rot[0]-uv[1]*rot[1]),1.1*(uv[0]*rot[1]+uv[1]*rot[0])];
                    <br>if (uv[1] > 10) { break; }
                    <br>l++;
                    <br>}
                    <br>let c = l % 2;
                    <br>return math.matrix([c, c, c]);
                    <br>}
                    <br>
                    <br>Q(x,y,frame)
                </code>
            </details>
        </div>
        <div class="out">
            <h2>输出</h2>
            <h3 id="outm" style="word-wrap:break-word;font-family: Consolas"></h3>
        </div>
    </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.6.1/math.min.js"></script>
<script src="plotscript.js"></script>

</html>